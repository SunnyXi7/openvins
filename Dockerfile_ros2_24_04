FROM ros:jazzy

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    cmake \
    git \
    libopencv-dev \
    libcgal-dev \
    libgoogle-glog-dev \
    libgflags-dev \
    libatlas-base-dev \
    libsuitesparse-dev \
    wget \
    && rm -rf /var/lib/apt/lists/*

# Create workspace
WORKDIR /root/openvins_ws/src

# Copy the current directory (open_vins) into the container
# Assuming this Dockerfile is built from the workspace root or src/open_vins is available
COPY . /root/openvins_ws/src/open_vins

# Install ROS dependencies
WORKDIR /root/openvins_ws
RUN . /opt/ros/jazzy/setup.sh && \
    apt-get update && \
    rosdep install --from-paths src --ignore-src -r -y && \
    rm -rf /var/lib/apt/lists/*

# Build
RUN . /opt/ros/jazzy/setup.sh && \
    colcon build --symlink-install --cmake-args -DCMAKE_BUILD_TYPE=Release

# Source entrypoint
COPY ./entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh
ENTRYPOINT ["/entrypoint.sh"]
CMD ["bash"]
